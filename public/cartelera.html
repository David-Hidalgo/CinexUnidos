<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="./../style.css" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
	<title>CinexUnidos</title>
</head>

<body>
	<header id="header"></header>
	<aside id="aside"></aside>
	<script type="module" src="./src/js/mainAside.js"></script>
	<hr />
	<main class="reserve-aside-space">
		<hgroup>
			<h1>Catálogo de películas</h1>
			<h2>En cartelera</h2>
		</hgroup>
		<section id="peículas">
			<!-- <figure>
				<img src="https://th.bing.com/th/id/OIP.nfEMVTdKvwQUi1EXVXi3pAHaK-?rs=1&pid=ImgDetMain"
					alt="poster de Avengers" width="30%" />
				<figcaption>Avengers Endgame</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>
			<figure>
				<img src="https://i.pinimg.com/236x/e7/b6/70/e7b670c72cd5a8a683dc9f6c05db801e.jpg"
					alt="poster de OUATIH" width="30%" />
				<figcaption>Once Upon a time in hollywood</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>

			<figure>
				<img src="https://i.blogs.es/d72a66/1-61-990x1485/450_1000.jpg" alt="poster de Jaws" width="30%" />
				<figcaption>Jaws</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>

			<figure>
				<img src="https://th.bing.com/th/id/OIP.nfEMVTdKvwQUi1EXVXi3pAHaK-?rs=1&pid=ImgDetMain"
					alt="poster de Avengers" width="30%" />
				<figcaption>Avengers Endgame</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>
			<figure>
				<img src="https://i.pinimg.com/236x/e7/b6/70/e7b670c72cd5a8a683dc9f6c05db801e.jpg"
					alt="poster de OUATIH" width="30%" />
				<figcaption>Once Upon a time in hollywood</figcaption>

				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>

			<figure>
				<img src="https://i.blogs.es/d72a66/1-61-990x1485/450_1000.jpg" alt="poster de Jaws" width="30%" />
				<figcaption>Jaws</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure> -->
		</section>

		<article id="Promociones">
			<h2>En promoción</h2>
			<figure>
				<img src="https://th.bing.com/th/id/OIP.nfEMVTdKvwQUi1EXVXi3pAHaK-?rs=1&pid=ImgDetMain"
					alt="poster de Avengers" width="30%" />
				<figcaption>Avengers Endgame</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>

			<figure>
				<img src="https://i.pinimg.com/236x/e7/b6/70/e7b670c72cd5a8a683dc9f6c05db801e.jpg"
					alt="poster de OUATIH" width="30%" />
				<figcaption>Once Upon a time in hollywood</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>

			<figure>
				<img src="https://i.blogs.es/d72a66/1-61-990x1485/450_1000.jpg" alt="poster de Jaws" width="30%" />
				<figcaption>Jaws</figcaption>
				<button type="button" popovertarget="PopUp" popovertargetaction="toggle">Ver Detalles</button>
			</figure>
		</article>
	</main>
	</section>
	<div popover id="PopUp">
		<p>
			<strong>la película dura: <time id="runtime-movie" datetime="PT4H18M3S"></time></strong>
			<br>
			<strong>Censura: <span id="rating"></span></strong>
		<nav><a href="./Butacas.html">Funciones Disponibles</a></nav>
		</p>
	</div>
</body>
<script>
	const backendUrl = "https://cinexunidos-production.up.railway.app/"
	let query = window.location.href;
	function cargarPelicula(id, runtimeD, ratingD) {
		console.log(runtimeD);
		const popUp = document.getElementById("PopUp")
		const runtime = popUp.querySelector("#runtime-movie")
		const rating = popUp.querySelector("#rating")
		runtime.textContent =runtimeD
		numeroS = runtimeD.split(" ")[0]
		numero = parseInt(numeroS)
		horas = Math.floor(numero/60)
		minutos = numero%60
	
		runtime.setAttribute('datetime',`PT${horas}H${minutos}M0S`)
		rating.textContent = ratingD
		//agarrar el único hijo nav de popUp y agarrar su único hijo a y cambiarle el href
		const nav = popUp.querySelector("nav")
		const a = nav.querySelector("a")
		a.href = `./Butacas.html?movie=${id}`

	}
	function obtenerTheatres() {
		console.log(window.location.href);
		fetch(`${backendUrl}theatres/${query.split("=")[1]}/auditoriums`)
			.then(response => response.json())
			.then(data => {
				console.log(data);
				const peliculas = document.getElementById("peículas")
				
				const salas = data
				let showtimes = salas.map(sala => sala.showtimes)
				console.log(showtimes);
				showtimes=showtimes.flat()
				let peliculasUnicas  = new Set();
				showtimes=showtimes
				.forEach(showtime => {
					if(!peliculasUnicas.has(showtime.movie.id)){
						peliculasUnicas.add(showtime.movie.id)
						const figure = document.createElement("figure")
						const img = document.createElement("img")
						const figcaption = document.createElement("figcaption")
						const button = document.createElement("button")
						img.src = backendUrl+showtime.movie.poster
						img.alt = `poster de ${showtime.movie.name}`
						figcaption.textContent = showtime.movie.name
						figure.setAttribute("class", "movie-poster")
						button.type = "button"
						button.setAttribute("popovertarget", "PopUp")
						button.setAttribute("popovertargetaction", "toggle")
						button.onclick = () => cargarPelicula(showtime.movie.id, showtime.movie.runningTime, showtime.movie.rating)
						button.textContent = "Ver Detalles"
						figure.appendChild(img)
						figure.appendChild(figcaption)
						figure.appendChild(button)
						figure.id = showtime.movie.id
						peliculas.appendChild(figure)
					}
				})
			})
	}
	obtenerTheatres()

</script>
<script type="text/javascript">
	function googleTranslateElementInit() {
	new google.translate.TranslateElement({
		pageLanguage: 'es',
		includedLanguages: 'es,en' // remove this line if you want to include all languages
	},'google_translate_element');
	}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</html>